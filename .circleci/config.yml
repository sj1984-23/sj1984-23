version: 2.1
orbs:
  aws-cli: circleci/aws-cli@2.0.3

jobs:
  example-job:
    environment:
      aws_region: us-west-2
      aws-secret-access-key: nDDOhBWpxkNdZ+EMmAZGY0DjtFYxNb2PfSQziS2o 
      aws-access-key-id: AKIAUQOYV4M3JMIIQGNC
      aws_account: 310228935478
    docker:
      # replace with your preferred image
      - image: cimg/base:stable
    steps:
      - aws-cli/install
      - run: aws --version
      - run: mkdir ~/aws && touch ~/aws/credentials
      - run: echo "[at-interviews] \n aws_access_key_id =  aws-access-key-id \n aws_secret_access_key = aws-secret-access-key" | cat ~/aws/credentials
      - run: aws eks update-kubeconfig --profile at-interviews --region aws_region --name at-interviews-cluster
      - run: kubectl config use-context arn:aws:eks:aws_region:aws_account:cluster/at-interviews-cluster
      - run: aws ecr get-login-password --profile at-interviews --region aws_region docker login --username AWS --password-stdin \
             aws_account.dkr.ecr.us-west-2.amazonaws.com

workflows:
  example-workflow:
    jobs:
      - example-job